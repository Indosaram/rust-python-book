---
marp: true
paginate: true
theme: default
---

# íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë¨¸ë¥¼ ìœ„í•œ ëŸ¬ìŠ¤íŠ¸ ì…ë¬¸

ìœ¤ì¸ë„
freedomzero91@gmail.com

---

# CH13. ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

---

## ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì´ë€?

ë¹„ë™ê¸° ëª¨ë¸ì—ì„œëŠ” ì—¬ëŸ¬ ê°€ì§€ ì¼ì´ ë™ì‹œì— ì¼ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì—ì„œ ì˜¤ë˜ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ë„ ì‹¤í–‰ íë¦„ì´ ì°¨ë‹¨ë˜ì§€ ì•Šê³  í”„ë¡œê·¸ë¨ì´ ê³„ì† ì‹¤í–‰ë©ë‹ˆë‹¤. í•¨ìˆ˜ê°€ ì™„ë£Œë˜ë©´ í”„ë¡œê·¸ë¨ì€ ê²°ê³¼ë¥¼ ì•Œê³  ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤.

---

![sync](../src/assets/ch13-1.png)

---

### ë¹„ë™ê¸° ì‘ë™ ë°©ì‹

í˜‘ë ¥ì  ë©€í‹°íƒœìŠ¤í‚¹

- íŒŒì´ì¬ : ì½”ë£¨í‹´
- ëŸ¬ìŠ¤íŠ¸ : íƒœìŠ¤í¬

ìš´ì˜ì²´ì œ -> ìŠ¤ë ˆë“œ
ëŸ°íƒ€ì„ -> ì½”ë£¨í‹´/íƒœìŠ¤í¬

---

> í˜‘ë ¥ì  ë©€í‹°íƒœìŠ¤í‚¹ì´ë€, ë©€í‹°íƒœìŠ¤í‚¹ì— ì°¸ì—¬í•˜ëŠ” ì£¼ì²´ë“¤ì´ ì–¸ì œë“  ìì‹ ì˜ ì‹¤í–‰ì„ ìë°œì ìœ¼ë¡œ ë©ˆì¶”ê³  ë‹¤ë¥¸ ì£¼ì²´ì—ê²Œ ì‹¤í–‰ ê¶Œí•œì„ ë„˜ê¸°ëŠ” ë°©ì‹ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ìš´ì˜ì²´ì œì—ì„œëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì–´ë–¤ ìŠ¤ë ˆë“œê°€ ì–¸ì œ ì‘ì—…ì„ ì‹¤í–‰í•˜ê³  ì¢…ë£Œí• ì§€ë¥¼ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë©€í‹°ìŠ¤ë ˆë”©ì„ í˜‘ë ¥ì  ë©€í‹°íƒœìŠ¤í‚¹ì´ ì•„ë‹™ë‹ˆë‹¤.

---

## tokio

ì•ì—ì„œ ì„¤ëª…í–ˆë“¯ì´, ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì„¤ëª…í•˜ë ¤ë©´ í”„ë¡œê·¸ë¨ ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ì˜ ì‹¤í–‰ì„ ê´€ë¦¬í•˜ëŠ” ë¹„ë™ê¸° ëŸ°íƒ€ì„ì´ í•„ìš”í•©ë‹ˆë‹¤. ëŸ¬ìŠ¤íŠ¸ëŠ” ë¹ŒíŠ¸ì¸ async ëŸ°íƒ€ì„ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ `tokio` ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. TokioëŠ” ë‹¤ìŒ ì„¸ ê°€ì§€ì˜ ì£¼ìš” êµ¬ì„± ìš”ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

- ë¹„ë™ê¸° ì½”ë“œ ì‹¤í–‰ì„ ìœ„í•œ ë©€í‹°ìŠ¤ë ˆë“œ ëŸ°íƒ€ì„.
- í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë¹„ë™ê¸° ë²„ì „.
- ëŒ€ê·œëª¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—ì½”ì‹œìŠ¤í…œ.

---

ì´ì œ í”„ë¡œì íŠ¸ì— `tokio` ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ `Cargo.toml`íŒŒì¼ì— `tokio`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë•Œ `features = ["full"]` ì„ ë„£ì–´ì•¼ ì „ì²´ ê¸°ëŠ¥ì„ ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```toml
[dependencies]
tokio = { version = "1.25.0", features = ["full"] }
```

---

### ë¹„ë™ê¸° í•¨ìˆ˜ ë§Œë“¤ì–´ë³´ê¸°

íŒŒì´ì¬ì—ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œ `asyncio` ë¼ëŠ” ë‚´ì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤.

ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ë ¤ë©´ ì¼ë°˜ í•¨ìˆ˜ ì •ì˜ ì•ì— `async` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì£¼ë©´ ë©ë‹ˆë‹¤.

```python
async def func():
    print("async")
```

---

ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ê·¸ëƒ¥ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ê²°ê³¼ ëŒ€ì‹  `coroutine` ê°ì²´ê°€ ë¦¬í„´ë˜ê³ , ê²½ê³ ê°€ ë°œìƒí•©ë‹ˆë‹¤.

```python
>>> print(func())

<coroutine object asynch at 0x10fe8e3b0>
/Users/temp/python/main.py:9: RuntimeWarning: coroutine 'func' was never awaited
  print(func())
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
```

---

ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë ¤ë©´, `asyncio.run` ê³¼ `await` í‚¤ì›Œë“œë¥¼ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```python
import asyncio

async def func():
    print("async")

async def main():
    await func()

asyncio.run(main())
```

---

`main` ì„ `async` ë¡œ ë°”ê¾¸ê³ , `#[tokio::main]` ë¥¼ `main` í•¨ìˆ˜ì— ë¶™ì—¬ì„œ ë¹„ë™ê¸° ë©”ì¸ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ ë©”ì¸ í•¨ìˆ˜ê°€ ë¹„ë™ê¸° í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì—ì„œ `async`ì™€ `await` í‚¤ì›Œë“œë¥¼ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

```rust
use tokio;

async fn func() {
    println!("async");
}

#[tokio::main]
async fn main() {
    func().await
}

```

---

ê·¸ë ‡ë‹¤ë©´ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  í”„ë¦°íŠ¸í•´ë³´ë©´ ì–´ë–¨ê¹Œìš”? ì¼ë‹¨ ì•„ë˜ ì½”ë“œëŠ” ì»´íŒŒì¼ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```rust
use tokio;

async fn func() {
    println!("async");
}

#[tokio::main]
async fn main() {
    println!("{:?}", func()) // ğŸ¤¯
}

```

---

ì‹¤í–‰ ê²°ê³¼

```rust
error[E0277]: `impl Future<Output = i32>` doesn't implement `std::fmt::Display`
 --> src/main.rs:9:22
  |
9 |     println!("{:#}", func())
  |                      ^^^^^^ `impl Future<Output = i32>` cannot be formatted
  with the default formatter
```

ì»´íŒŒì¼ ì—ëŸ¬ë¥¼ ë“¤ì—¬ë‹¤ë³´ë©´, í•¨ìˆ˜ `func`ì˜ ë¦¬í„´ê°’ì´`impl Future<Output = i32>`ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

> ìë°”ìŠ¤í¬ë¦½íŠ¸ë‚˜ C#ê³¼ ê°™ì€ ì–¸ì–´ì˜ ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ì€ í”„ë¼ë¯¸ìŠ¤(Promise) ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ ìˆì–´ì„œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ë§Œ, íŒŒì´ì¬ê³¼ ëŸ¬ìŠ¤íŠ¸ëŠ” ì‹¤í–‰í•  ìˆ˜ ìˆì„ ë•Œ ì‹¤í–‰í•˜ëŠ” ë°©ì‹(lazy execution)ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

í•˜ì§€ë§Œ ë‹¨ìˆœíˆ `await`ë¥¼ ì‚¬ìš©í•˜ê¸°ë§Œ í•´ì„œëŠ” ê¸°ì¡´ì˜ ë™ê¸° í•¨ìˆ˜ì™€ ë¹„ìŠ·í•œ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.

```rust
async fn hello() -> i32 {
    println!("Hello World!");
    tokio::time::sleep(std::time::Duration::from_secs(3)).await;
    println!("waited");
    1
}

async fn bye() -> i32 {
    println!("Goodbye!");
    2
}

#[tokio::main]
async fn main() {
    hello().await; // blocking
    bye().await;
}

```

---

ì‹¤í–‰ ê²°ê³¼

```
Hello World!
waited
Goodbye!
```

---

### ë¦¬í„´ê°’ì´ ìˆëŠ” ë¹„ë™ê¸° í•¨ìˆ˜

ë§Œì¼ ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œ ê°’ì„ ë¦¬í„´í•œë‹¤ë©´ ê·¸ ê°’ì„ ì–´ë–»ê²Œ ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”? íŒŒì´ì¬ê³¼ ëŸ¬ìŠ¤íŠ¸ ëª¨ë‘, ë‹¨ìˆœíˆ ê¸°ì¡´ ë™ê¸° í•¨ìˆ˜ì²˜ëŸ¼ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , í•¨ìˆ˜ ì •ì˜ì— `async` í‚¤ì›Œë“œë§Œ ë¶™ì—¬ì£¼ë©´ ë©ë‹ˆë‹¤. ë¨¼ì € íŒŒì´ì¬ì˜ ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. `await` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì„œ í˜¸ì¶œí•˜ê³  ë‚˜ë©´ í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

```python
import asyncio


async def func():
    return "async"


async def main():
    result = await func()
    print(result)


asyncio.run(main())
```

ì‹¤í–‰ ê²°ê³¼

```
async
```

---

ëŸ¬ìŠ¤íŠ¸ì—ì„œë„ í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì€ `await` ì„ ì‚¬ìš©í•˜ê³  ë‚˜ë©´ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```rust
use tokio;

async fn func<'a>() -> &'a str {
    "async"
}

#[tokio::main]
async fn main() {
    println!("{:?}", func().await)
}

```

ì‹¤í–‰ ê²°ê³¼

```
"async"
```

---

### ì—¬ëŸ¬ ì‘ì—… ì‹¤í–‰í•˜ê¸°

`asyncio.gather` ë¥¼ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í•œêº¼ë²ˆì— ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

```python
import asyncio

async def give_order(order):
    print(f"Processing {order}...")
    await asyncio.sleep(3 - order)
    print(f"Finished {order}")

async def main():
    await asyncio.gather(give_order(1), give_order(2), give_order(3))

asyncio.run(main())
```

---

ì‹¤í–‰ ê²°ê³¼

```python
Processing 1...
Processing 2...
Processing 3...
Finished 3
Finished 2
Finished 1
```

---

ë§Œì¼ ê° í•¨ìˆ˜ì— ë¦¬í„´ê°’ì´ ìˆë‹¤ë©´ ê°’ì´ ëª¨ì•„ì ¸ì„œ ë¦¬í„´ë©ë‹ˆë‹¤.

```python
import asyncio

async def give_order(order):
    print(f"Processing {order}...")
    await asyncio.sleep(3 - order)
    print(f"Finished {order}")
    return order

async def main():
    results = await asyncio.gather(give_order(1), give_order(2), give_order(3))
    print(results)

asyncio.run(main())
```

---

ì‹¤í–‰ ê²°ê³¼

```
Processing 1...
Processing 2...
Processing 3...
Finished 3
Finished 2
Finished 1
[1, 2, 3]
```

---

ëŸ¬ìŠ¤íŠ¸ì—ì„œëŠ” `tokio::join!`ì— ê¸°ë‹¤ë¦¬ê³ ì í•˜ëŠ” í•¨ìˆ˜ë“¤ì„ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.

```rust
async fn give_order(order: u64) -> u64 {
    println!("Processing {order}...");
    tokio::time::sleep(std::time::Duration::from_secs(3 - order)).await;
    println!("Finished {order}");
    order
}

#[tokio::main]
async fn main() {
    let result = tokio::join!(give_order(1), give_order(2), give_order(3));

    println!("{:?}", result);
}


```

---

ì‹¤í–‰ ê²°ê³¼

```
Processing 1...
Processing 2...
Processing 3...
Finished 3
Finished 2
Finished 1
(1, 2, 3)
```

---

### ì˜ˆì œ: ë¹ ë¥´ê²Œ HTTP ìš”ì²­ ë³´ë‚´ë³´ê¸°

---

íŒŒì´ì¬ ë™ê¸°

```python
import requests
from random import randint


# The highest Pokemon id
MAX_POKEMON = 898


def fetch(total):
    urls = [
        f"https://pokeapi.co/api/v2/pokemon/{randint(1, MAX_POKEMON)}"
        for _ in range(total)
    ]
    with requests.Session() as session:
        for url in urls:
            response = session.get(url).json()
            yield response["name"]


def main():
    for name in fetch(10):
        print(name)

    print([name for name in fetch(10)])


main()
```

---

`Cargo.toml` ì— ì¶”ê°€

\- `rand`: ëœë¤ê°’ ìƒì„±
\- `reqwest`: HTTP ìš”ì²­
\- `serde_json`: ë°ì´í„° ì§ë ¬/ì—­ì§ë ¬í™”

```toml
rand = "0.8.5"
reqwest = { version="0.11.16", features = ["blocking", "json"] }
serde_json = "1.0.95"
```

`rand::thread_rng()` ë¡œ 1ë¶€í„° 898ê¹Œì§€ì˜ ë¬´ì‘ìœ„ ë‚œìˆ˜ ìƒì„±

`reqwest::blocking::Client::new()` ë™ê¸° ë°©ì‹ì˜ HTTP í´ë¼ì´ì–¸íŠ¸ ìƒì„±

`.json::<serde_json::Value>()` ì‘ë‹µ jsonì˜ í˜•ì‹ì„ ë¯¸ë¦¬ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš° ì‚¬ìš©, ì¼ë°˜ì ìœ¼ë¡œëŠ” ì‘ë‹µ í˜•ì‹ì„ ì•Œê³  ìˆì–´ì„œ êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•´ íƒ€ì…ì„ ëª…ì‹œ

---

```rust
use rand::Rng;
use reqwest;
use serde_json;

const MAX_POKEMON: u32 = 898;

fn fetch(total: u32) -> Vec<String> {
    let mut urls = Vec::new();
    for _ in 0..total {
        let url = format!(
            "https://pokeapi.co/api/v2/pokemon/{}",
            rand::thread_rng().gen_range(1..=MAX_POKEMON)
        );
        urls.push(url);
    }
    let client = reqwest::blocking::Client::new();
    let mut names = Vec::new();
    for url in urls {
        let response = client
            .get(&url)
            .send()
            .unwrap()
            .json::<serde_json::Value>()
            .unwrap();
        names.push(response["name"].as_str().unwrap().to_string());
    }
    names
}

fn main() {
    for name in fetch(10) {
        println!("{}", name);
    }

    println!("{:?}", fetch(10));
}

```

---

ì‹¤í–‰ ê²°ê³¼

```python
grumpig
dartrix
celesteela
piloswine
tangrowth
virizion
glastrier
dewpider
hattrem
glameow
['boltund', 'gourgeist-average', 'shellos', 'shiinotic', 'eevee', 'cranidos', 'celesteela',
'solosis', 'houndour', 'landorus-incarnate']
```

---

íŒŒì´ì¬ ë¹„ë™ê¸°

```python
import asyncio
import aiohttp
from random import randint


# The highest Pokemon id
MAX_POKEMON = 898


async def _fetch(session, url):
    async with session.get(url) as response:
        return await response.json()


async def fetch(total):
    urls = [
        f"https://pokeapi.co/api/v2/pokemon/{randint(1, MAX_POKEMON)}"
        for _ in range(total)
    ]
    async with aiohttp.ClientSession() as session:
        tasks = [_fetch(session, url) for url in urls]
        responses = await asyncio.gather(*tasks)
        for response in responses:
            yield response["name"]


async def main():
    async for name in fetch(10):
        print(name)

    print([name async for name in fetch(10)])


asyncio.run(main())
```

---

ëŸ¬ìŠ¤íŠ¸ ë¹„ë™ê¸°

```rust
use rand::Rng;
use reqwest;

const MAX_POKEMON: u32 = 898;

async fn fetch(total: u32) -> Vec<String> {
    let mut urls = Vec::new();
    for _ in 0..total {
        let url = format!(
            "https://pokeapi.co/api/v2/pokemon/{}",
            rand::thread_rng().gen_range(1..=MAX_POKEMON)
        );
        urls.push(url);
    }
    let client = reqwest::Client::new();
    let mut names = Vec::new();
    for url in urls {
        let response = client
            .get(&url)
            .send()
            .await
            .unwrap()
            .json::<serde_json::Value>()
            .await
            .unwrap();
        names.push(response["name"].as_str().unwrap().to_string());
    }
    names
}

#[tokio::main]
async fn main() {
    for name in fetch(10).await {
        println!("{}", name);
    }

    println!("{:?}", fetch(10).await);
}

```

---

## rayon

ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ê³¼ëŠ” í° ìƒê´€ì´ ì—†ì§€ë§Œ, `tokio` ì™€ ìì£¼ ë¹„êµë˜ëŠ” í¬ë ˆì´íŠ¸ì¸ `rayon` ì— ëŒ€í•´ì„œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

### tokio vs rayon

TokioëŠ” ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ëŠ” ë° ì´ìƒì ì´ë©°, Rayonì€ ëŒ€ê·œëª¨ ë°ì´í„° ì»¬ë ‰ì…˜ì— ëŒ€í•œ ê³„ì‚°ì„ ë³‘ë ¬í™”í•˜ëŠ” ë° ì´ìƒì ì…ë‹ˆë‹¤.

---

### ë³‘ë ¬ ì´í„°ë ˆì´í„°

```bash
cargo add rayon
```

ê³µì‹ ë¬¸ì„œì—ì„œ ê¶Œì¥í•˜ëŠ” ì‚¬ìš© ë°©ë²•ì€ `prelude` ë°‘ì— ìˆëŠ” ëª¨ë“  ê²ƒì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë³‘ë ¬ ì´í„°ë ˆì´í„°ì™€ ë‹¤ë¥¸ íŠ¸ë ˆì´íŠ¸ë¥¼ ì „ë¶€ ë¶ˆëŸ¬ì˜¤ê¸° ë•Œë¬¸ì— ì½”ë“œë¥¼ í›¨ì”¬ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```rust
use rayon::prelude::*;
```

---

ê¸°ì¡´ì˜ ìˆœì°¨ ê³„ì‚° í•¨ìˆ˜ì— ë³‘ë ¬ì„±ì„ ë”í•˜ë ¤ë©´, ë‹¨ìˆœíˆ ì´í„°ë ˆì´í„°ë¥¼ `par_iter`ë¡œ ë°”ê¿”ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

```rust
use rayon::prelude::*;
use std::time::SystemTime;

fn sum_of_squares(input: &Vec<i32>) -> i32 {
    input
        .par_iter() // âœ¨
        .map(|&i| {
            std::thread::sleep(std::time::Duration::from_millis(10));
            i * i
        })
        .sum()
}

fn sum_of_squares_seq(input: &Vec<i32>) -> i32 {
    input
        .iter()
        .map(|&i| {
            std::thread::sleep(std::time::Duration::from_millis(10));
            i * i
        })
        .sum()
}

fn main() {
    let start = SystemTime::now();
    sum_of_squares(&(1..100).collect());
    println!("{}ms", start.elapsed().unwrap().as_millis());
    let start = SystemTime::now();
    sum_of_squares_seq(&(1..100).collect());
    println!("{}ms", start.elapsed().unwrap().as_millis());
}

```

---

ì‹¤í–‰ ê²°ê³¼

```
106ms
1122ms
```

---

par_iter_mut ëŠ” ê° ì›ì†Œì˜ ê°€ë³€ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë°›ëŠ” ì´í„°ë ˆì´í„°ì…ë‹ˆë‹¤.

```rust
use rayon::prelude::*;

use std::time::SystemTime;

fn plus_one(x: &mut i32) {
    *x += 1;
    std::thread::sleep(std::time::Duration::from_millis(10));
}

fn increment_all_seq(input: &mut [i32]) {
    input.iter_mut().for_each(plus_one);
}

fn increment_all(input: &mut [i32]) {
    input.par_iter_mut().for_each(plus_one);
}

fn main() {
    let mut data = vec![1, 2, 3, 4, 5];

    let start = SystemTime::now();
    increment_all(&mut data);
    println!("{:?} - {}ms", data, start.elapsed().unwrap().as_millis());

    let start = SystemTime::now();
    increment_all_seq(&mut data);
    println!("{:?} - {}ms", data, start.elapsed().unwrap().as_millis());
}

```

---

ì‹¤í–‰ ê²°ê³¼

```
[2, 3, 4, 5, 6] - 12ms
[3, 4, 5, 6, 7] - 55ms
```

---

`par_sort` ëŠ” ë³‘í•© ì •ë ¬ì„ ì‘ìš©í•œ ì •ë ¬ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë³‘ë ¬ì ìœ¼ë¡œ ë¶„í• í•´ ì •ë ¬í•©ë‹ˆë‹¤.

```rust
use rand::Rng;
use rayon::prelude::*;

use std::time::SystemTime;

fn main() {
    let mut rng = rand::thread_rng();
    let mut data1: Vec<i32> = (0..1_000_000).map(|_| rng.gen_range(0..=100)).collect();
    let mut data2 = data1.clone();

    let start = SystemTime::now();
    data1.par_sort();
    println!("{}ms", start.elapsed().unwrap().as_millis());

    let start = SystemTime::now();
    data2.sort();
    println!("{}ms", start.elapsed().unwrap().as_millis());

    assert_eq!(data1, data2);
}

```

---

ì‹¤í–‰ ê²°ê³¼

```
68ms
325ms
```

---

### Rayon ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­

ë©€í‹°ìŠ¤ë ˆë“œë„ ë§ˆì°¬ê°€ì§€ì§€ë§Œ ìŠ¤ë ˆë“œ ìŠ¤í° ë° ì¡°ì¸ì— ì‹œê°„ì´ ì†Œìš”ë˜ê¸° ë•Œë¬¸ì— ì£¼ì˜
